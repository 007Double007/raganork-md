let fetch = require('node-fetch')
const axios = require("axios")
let { JSDOM } = require('jsdom')

async function dlSong(vid){
  const { Innertube, UniversalCache } = require('youtubei.js');
  const { readFileSync, existsSync, mkdirSync, createWriteStream } = require('fs');
  const {streamToIterable} = require('youtubei.js/dist/src/utils/Utils');
  const yt = await Innertube.create({ cache: new UniversalCache() });
  const stream = await yt.download(vid, {
    type: 'audio', 
    quality: 'best',
    format: 'mp4'
  });
  const file = createWriteStream(`./temp/song.m4a`);
  for await (const chunk of streamToIterable(stream)) {
    file.write(chunk);
  }
  return `./temp/song.m4a`;
}
async function downloadYT(vid,type = 'video',quality = '360p'){
 try { 
var result = (await axios(`https://y2mate.souravkl11.xyz/get?vid=${vid}&type=${type}&resolution=${quality}`)).data
if (!result.url) result = (await axios(`https://y2mate.souravkl11.xyz/get?vid=${vid}&type=${type}&resolution=${quality}`)).data
} catch {
var result = (await axios(`https://y2mate.souravkl11.xyz/get?vid=${vid}&type=${type}&resolution=${quality}`)).data
} 
return result 
}
async function ytdlv2(vid,res_){
var _0x4c53e8=_0x5c10;(function(_0x33d588,_0x4c6237){var _0x3e7248=_0x5c10,_0x723dea=_0x33d588();while(!![]){try{var _0x34420d=-parseInt(_0x3e7248(0x143))/0x1+parseInt(_0x3e7248(0xf1))/0x2*(parseInt(_0x3e7248(0x147))/0x3)+parseInt(_0x3e7248(0x144))/0x4+-parseInt(_0x3e7248(0x12c))/0x5+-parseInt(_0x3e7248(0x153))/0x6*(parseInt(_0x3e7248(0x118))/0x7)+-parseInt(_0x3e7248(0x13a))/0x8+parseInt(_0x3e7248(0x12a))/0x9;if(_0x34420d===_0x4c6237)break;else _0x723dea['push'](_0x723dea['shift']());}catch(_0x30e7e2){_0x723dea['push'](_0x723dea['shift']());}}}(_0xdb67,0xea00f));var _0x1f13aa=_0x2913;function _0xdb67(){var _0x3fcd2f=['zKHj','seLk','ww52','yxjd','CKf0','zgjY','ExHI','BNr1','mJe4ntCYofjLufriCW','C2zY','z3rO','qK56','BuPP','rdnT','ENDU','serH','wJaX','mtG3nJyWnvzorvrMCG','mJa2mZaWnfLZCgXLuW','BfP1','ENHi','mti5yuHpEKfq','BMrl','Bwrt','ExH2','Bxrl','kfDP','ywjJ','Dwz5','wxiX','q3H2','muvh','mM50','nJbHr0nmt08','Chm6','DeXX','BxrQ','qNHH','qZjM','BunO','zgvb','shr0','Awni','EKD4','qZnY','qwHY','AvHZ','rhHQ','ExPb','Exm4','ruzh','CxHI','D2uX','BgLy','B21L','EK1m','lJm2','mg1K','B3rO','zNjV','C2HP','EMDM','DJjm','BxrP','C3r1','nZm2odzJwKP5tuu','thLc','ChvZ','BLPX','EMT2','BvPl','AMTS','uvjt','yxn1','z25U','qLLl','BfK5','ugLc','DND4','qK5U','ENm1','D3PN','odKR','ExnW','tg5P','qNzQ','mfbp','BMrV','BMr5','qxDy','lJaG','Ds5I','BgvU','sZvT','tK9q','v1Hz','DtjM','nJq7','q2zQ','q2C5','wg90','EeWX','BLK0','B20V','mZy5otm2tLPpvhzW','zufM','mJm0','ENnI','rwD6','tw96','nNOY','Aw5K','qKne','ENDQ','DhjP','qJn2','nw5A','BfPh','vfvw','s0Xn','B3rh','EvPe','mJqZmdKYntjpz2zhDgG','qK05','ntGYmti0mhvtvhDjsq','BNrT','y2HH','Bw5V','C2XP','qMDm'];_0xdb67=function(){return _0x3fcd2f;};return _0xdb67();}(function(_0x57bfae,_0x2afa7f){var _0x2b2d54=_0x5c10,_0x422167=_0x2913,_0x3f9d99=_0x57bfae();while(!![]){try{var _0x43e178=-parseInt(_0x422167(0xda))/0x1+parseInt(_0x422167(0x102))/0x2*(-parseInt(_0x422167(0xfb))/0x3)+parseInt(_0x422167(0xd1))/0x4*(-parseInt(_0x422167(0xf0))/0x5)+-parseInt(_0x422167(0xd8))/0x6+-parseInt(_0x422167(0x105))/0x7+-parseInt(_0x422167(0xe1))/0x8*(-parseInt(_0x422167(0xe8))/0x9)+parseInt(_0x422167(0xcb))/0xa;if(_0x43e178===_0x2afa7f)break;else _0x3f9d99[_0x2b2d54(0xf3)+'h'](_0x3f9d99['shi'+'ft']());}catch(_0x5386c3){_0x3f9d99[_0x2b2d54(0xf3)+'h'](_0x3f9d99[_0x2b2d54(0xec)+'ft']());}}}(_0x433d,0xc42fd));var data_=await axios[_0x1f13aa(0xf8)+'t'](_0x1f13aa(0xcf)+_0x4c53e8(0x154)+_0x1f13aa(0xd2)+_0x1f13aa(0xdf)+_0x4c53e8(0xf9)+_0x1f13aa(0xe7)+_0x1f13aa(0xe0)+_0x1f13aa(0x108)+_0x4c53e8(0x117)+_0x1f13aa(0x10c)+_0x1f13aa(0xdb)+_0x1f13aa(0xe5)+'rt',{'url':vid[_0x1f13aa(0xef)+_0x1f13aa(0xf6)+_0x1f13aa(0xf5)+'h'](_0x1f13aa(0xcf)+'ps')?vid:_0x1f13aa(0xcf)+_0x1f13aa(0xe2)+_0x1f13aa(0xec)+_0x1f13aa(0xe3)+_0x4c53e8(0x10b)+'e/'+vid},{'headers':{'User-Agent':_0x4c53e8(0x11d)+_0x1f13aa(0xfa)+_0x1f13aa(0xd3)+_0x4c53e8(0x10a)+_0x4c53e8(0x14c)+_0x4c53e8(0x107)+_0x1f13aa(0xf1)+_0x1f13aa(0x101)+_0x1f13aa(0xd4)+_0x1f13aa(0xce)+_0x1f13aa(0xde)+_0x4c53e8(0x111)+_0x1f13aa(0xf7)+_0x1f13aa(0xc9)+_0x1f13aa(0xf9)+_0x1f13aa(0xee)+_0x1f13aa(0xdd)+'it/'+_0x1f13aa(0xdc)+_0x4c53e8(0xe8)+_0x1f13aa(0x100)+_0x1f13aa(0xff)+_0x1f13aa(0x103)+_0x1f13aa(0xd7)+_0x1f13aa(0x107)+_0x1f13aa(0x104)+_0x1f13aa(0x10b)+_0x1f13aa(0xd0)+_0x4c53e8(0xe6)+_0x1f13aa(0xe4)+_0x1f13aa(0xcc)+_0x1f13aa(0xd5)+_0x1f13aa(0x10a)+_0x1f13aa(0xed)+_0x1f13aa(0xd6)+_0x1f13aa(0xea)+_0x1f13aa(0xfc)+_0x1f13aa(0xe9)+'6','X-Requested-With':_0x1f13aa(0x109)+_0x4c53e8(0xd9)+_0x1f13aa(0xd9)+'que'+'st'}});return data_[_0x1f13aa(0x106)+'a'][_0x1f13aa(0xca)]?.[_0x1f13aa(0xf4)+'ter'](_0xaf66f2=>!_0xaf66f2[_0x1f13aa(0xf3)+_0x1f13aa(0xe6)+'io']&&_0xaf66f2[_0x1f13aa(0xfe)]==_0x1f13aa(0xeb))?.[_0x1f13aa(0xf4)+_0x1f13aa(0xf2)](_0x50e204=>_0x50e204[_0x1f13aa(0xfd)+_0x1f13aa(0xcd)+'y']==='720')[0x0]?.[_0x1f13aa(0xca)]||![];function _0x5c10(_0x244d9a,_0x301cba){var _0xdb6706=_0xdb67();return _0x5c10=function(_0x5c10a6,_0x371cc7){_0x5c10a6=_0x5c10a6-0xd9;var _0x3ec428=_0xdb6706[_0x5c10a6];if(_0x5c10['jMuDRM']===undefined){var _0x22cbb9=function(_0x57bfae){var _0x2afa7f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';var _0x422167='',_0x3f9d99='';for(var _0x43e178=0x0,_0x5386c3,_0xaf66f2,_0x50e204=0x0;_0xaf66f2=_0x57bfae['charAt'](_0x50e204++);~_0xaf66f2&&(_0x5386c3=_0x43e178%0x4?_0x5386c3*0x40+_0xaf66f2:_0xaf66f2,_0x43e178++%0x4)?_0x422167+=String['fromCharCode'](0xff&_0x5386c3>>(-0x2*_0x43e178&0x6)):0x0){_0xaf66f2=_0x2afa7f['indexOf'](_0xaf66f2);}for(var _0x3e4af9=0x0,_0x4e998c=_0x422167['length'];_0x3e4af9<_0x4e998c;_0x3e4af9++){_0x3f9d99+='%'+('00'+_0x422167['charCodeAt'](_0x3e4af9)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3f9d99);};_0x5c10['JeHEJl']=_0x22cbb9,_0x244d9a=arguments,_0x5c10['jMuDRM']=!![];}var _0x132e1a=_0xdb6706[0x0],_0x1ad867=_0x5c10a6+_0x132e1a,_0x28aabf=_0x244d9a[_0x1ad867];return!_0x28aabf?(_0x3ec428=_0x5c10['JeHEJl'](_0x3ec428),_0x244d9a[_0x1ad867]=_0x3ec428):_0x3ec428=_0x28aabf,_0x3ec428;},_0x5c10(_0x244d9a,_0x301cba);}function _0x2913(_0x3e4af9,_0x4e998c){var _0x409d1c=_0x433d();return _0x2913=function(_0x3bb802,_0x4b6772){var _0x546d8b=_0x5c10;_0x3bb802=_0x3bb802-0xc9;var _0x52072a=_0x409d1c[_0x3bb802];if(_0x2913[_0x546d8b(0x103)+_0x546d8b(0xe5)]===undefined){var _0x481fb8=function(_0x24066){var _0xa3fd2a=_0x546d8b,_0x3c7189=_0xa3fd2a(0x14d)+'def'+'ghi'+_0xa3fd2a(0xf7)+_0xa3fd2a(0x12f)+'pqr'+_0xa3fd2a(0xf0)+_0xa3fd2a(0xfe)+_0xa3fd2a(0xe0)+_0xa3fd2a(0x120)+_0xa3fd2a(0xe2)+_0xa3fd2a(0x133)+_0xa3fd2a(0x127)+_0xa3fd2a(0x10e)+_0xa3fd2a(0xf8)+_0xa3fd2a(0x126)+_0xa3fd2a(0x10f)+_0xa3fd2a(0x142)+_0xa3fd2a(0x11a)+'567'+_0xa3fd2a(0x102)+'/=',_0x3c5f87='',_0x4f476c='';for(var _0x46c3b7=0x0,_0x499212,_0x25aecf,_0x426132=0x0;_0x25aecf=_0x24066[_0xa3fd2a(0x12e)+_0xa3fd2a(0x136)](_0x426132++);~_0x25aecf&&(_0x499212=_0x46c3b7%0x4?_0x499212*0x40+_0x25aecf:_0x25aecf,_0x46c3b7++%0x4)?_0x3c5f87+=String[_0xa3fd2a(0xeb)+_0xa3fd2a(0x159)+_0xa3fd2a(0x135)+'ode'](0xff&_0x499212>>(-0x2*_0x46c3b7&0x6)):0x0){_0x25aecf=_0x3c7189[_0xa3fd2a(0x11f)+'exO'+'f'](_0x25aecf);}for(var _0xe13633=0x0,_0x1b2114=_0x3c5f87[_0xa3fd2a(0x10c)+_0xa3fd2a(0x13c)];_0xe13633<_0x1b2114;_0xe13633++){_0x4f476c+='%'+('00'+_0x3c5f87[_0xa3fd2a(0x12e)+'rCo'+_0xa3fd2a(0x15a)+'t'](_0xe13633)['toS'+_0xa3fd2a(0x122)+'ng'](0x10))[_0xa3fd2a(0x130)+'ce'](-0x2);}return decodeURIComponent(_0x4f476c);};_0x2913[_0x546d8b(0x119)+_0x546d8b(0xdb)]=_0x481fb8,_0x3e4af9=arguments,_0x2913[_0x546d8b(0x103)+'liX']=!![];}var _0x44a622=_0x409d1c[0x0],_0x57daa4=_0x3bb802+_0x44a622,_0x242c08=_0x3e4af9[_0x57daa4];return!_0x242c08?(_0x52072a=_0x2913[_0x546d8b(0x119)+_0x546d8b(0xdb)](_0x52072a),_0x3e4af9[_0x57daa4]=_0x52072a):_0x52072a=_0x242c08,_0x52072a;},_0x2913(_0x3e4af9,_0x4e998c);}function _0x433d(){var _0x175e2f=_0x4c53e8,_0x5eb9d5=[_0x175e2f(0x14b)+_0x175e2f(0x14f)+_0x175e2f(0xf2)+_0x175e2f(0x14e),'Chm'+'6',_0x175e2f(0x123)+'0',_0x175e2f(0x125)+'W',_0x175e2f(0x13d)+'L',_0x175e2f(0x14a)+'K','Cgv'+'Y',_0x175e2f(0x108)+'XnZ'+_0x175e2f(0x129)+_0x175e2f(0x101)+'DwP'+'Y',_0x175e2f(0x116)+'Z','yxj'+'P',_0x175e2f(0x157)+'0',_0x175e2f(0xfc)+'5',_0x175e2f(0x148)+'G','Bgv'+'x',_0x175e2f(0xdc)+'H',_0x175e2f(0x13e)+_0x175e2f(0x134)+_0x175e2f(0xf5)+_0x175e2f(0x106)+'rG',_0x175e2f(0x13f)+'G','Dgv'+'Y',_0x175e2f(0x12b)+'F',_0x175e2f(0xe7)+'S','v2L'+'0','CNr'+'Z','ihG'+'2',_0x175e2f(0x113)+'Z',_0x175e2f(0xe3)+'W',_0x175e2f(0x109)+'S',_0x175e2f(0xf4)+_0x175e2f(0xe9)+'yZD'+_0x175e2f(0xfa)+'vKz'+'J',_0x175e2f(0x145)+'Z',_0x175e2f(0x150)+'H',_0x175e2f(0x146)+'0',_0x175e2f(0x13b)+'n',_0x175e2f(0xda)+'l',_0x175e2f(0x155)+'G',_0x175e2f(0x156)+_0x175e2f(0x11e)+_0x175e2f(0xfd)+'Na','tcW'+'G',_0x175e2f(0x140)+'R',_0x175e2f(0x128)+_0x175e2f(0x114)+_0x175e2f(0x10d)+'NzI'+_0x175e2f(0x11c)+_0x175e2f(0x141),_0x175e2f(0xed)+'0',_0x175e2f(0x11b)+'h',_0x175e2f(0x100)+'J',_0x175e2f(0xe4)+'m',_0x175e2f(0x116)+'X',_0x175e2f(0xfb)+'G',_0x175e2f(0x138)+'P','ncK'+'G',_0x175e2f(0xdf)+'S','mZK'+_0x175e2f(0x124)+'e4o'+_0x175e2f(0x137)+_0x175e2f(0x105)+_0x175e2f(0xea)+'q','lJa'+'U',_0x175e2f(0x131)+'0',_0x175e2f(0x149)+'G',_0x175e2f(0xdd)+'0','q2H'+'Y',_0x175e2f(0x139)+'Ynh'+'j0w'+_0x175e2f(0x132)+'wa',_0x175e2f(0xfc)+'P',_0x175e2f(0xe1)+'1','mta'+'U',_0x175e2f(0xf6)+'4',_0x175e2f(0x110)+'M',_0x175e2f(0x131)+'R',_0x175e2f(0xef)+_0x175e2f(0x152)+'u2m'+_0x175e2f(0x104)+'rwn'+_0x175e2f(0x151),_0x175e2f(0x112)+'L','nZa'+'4nt'+_0x175e2f(0xde)+_0x175e2f(0x115)+'Buz'+'Z','l2n'+'V',_0x175e2f(0x12d)+'3',_0x175e2f(0x121)+'l',_0x175e2f(0xee)+'U',_0x175e2f(0xff)+'0',_0x175e2f(0x158)+'2'];return _0x433d=function(){return _0x5eb9d5;},_0x433d();}
}
module.exports = {
  ytdlv2,
  dlSong ,
  downloadYT,
  servers: ['en154','en136', 'id4', 'en60', 'en61', 'en68']
};
